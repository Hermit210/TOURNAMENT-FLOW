<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TournamentFlow ‚Äî Gaming Tournaments</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  </head>
  <body class="bg-slate-950 text-slate-100 min-h-screen">
    <header class="border-b border-slate-800/60 bg-slate-900/60 backdrop-blur sticky top-0 z-50">
      <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <img src="./logo.svg" class="h-8 w-8" alt="TournamentFlow logo"/>
          <a href="./index.html" class="font-semibold text-indigo-300">TournamentFlow</a>
        </div>
        <nav class="hidden sm:flex items-center gap-6 text-sm">
          <a class="text-slate-300 hover:text-white transition-colors" href="./tournaments.html">Tournaments</a>
          <a class="text-slate-300 hover:text-white transition-colors" href="./rewards.html">Rewards</a>
          <a class="text-slate-300 hover:text-white transition-colors" href="./docs.html">Docs</a>
          <button id="connect" class="px-3 py-1.5 rounded bg-slate-800 hover:bg-slate-700 transition-colors">Connect Wallet</button>
        </nav>
        <button id="mobile-menu" class="sm:hidden p-2 text-slate-300 hover:text-white">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
      <div id="mobile-nav" class="hidden sm:hidden border-t border-slate-800/60 bg-slate-900/80 backdrop-blur">
        <nav class="max-w-6xl mx-auto px-4 py-3 flex flex-col gap-3 text-sm">
          <a class="text-slate-300 hover:text-white transition-colors" href="./tournaments.html">Tournaments</a>
          <a class="text-slate-300 hover:text-white transition-colors" href="./rewards.html">Rewards</a>
          <a class="text-slate-300 hover:text-white transition-colors" href="./docs.html">Docs</a>
          <button id="connect-mobile" class="px-3 py-1.5 rounded bg-slate-800 hover:bg-slate-700 transition-colors text-left">Connect Wallet</button>
        </nav>
      </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-8">
      <div class="mb-8">
        <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4">
          <div>
            <h1 class="text-2xl md:text-3xl font-bold mb-2">Gaming Tournaments</h1>
            <p class="text-slate-400">Join decentralized tournaments with automated registration, scheduling, and prize distribution powered by Kwala.</p>
          </div>
          <div class="flex items-center gap-4 mt-4 sm:mt-0">
            <div class="flex items-center gap-2">
              <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
              <span class="text-sm text-slate-400">Live on Kwala Testnet</span>
            </div>
            <div class="text-sm text-slate-400">
              <span id="active-tournaments-count">8</span> Active Tournaments
            </div>
          </div>
        </div>
        
        <!-- Quick Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-slate-900/40 border border-slate-800 rounded-lg">
          <div class="text-center">
            <div class="text-lg font-bold text-indigo-300" id="total-prize-pool">23.6 ETH</div>
            <div class="text-xs text-slate-400">Total Prize Pool</div>
          </div>
          <div class="text-center">
            <div class="text-lg font-bold text-green-400" id="active-players">156</div>
            <div class="text-xs text-slate-400">Active Players</div>
          </div>
          <div class="text-center">
            <div class="text-lg font-bold text-blue-400" id="tournaments-today">12</div>
            <div class="text-xs text-slate-400">Tournaments Today</div>
          </div>
          <div class="text-center">
            <div class="text-lg font-bold text-purple-400" id="avg-payout">2.1s</div>
            <div class="text-xs text-slate-400">Avg Payout Time</div>
          </div>
        </div>
      </div>

      <!-- Tournament Filters -->
      <section class="mb-6">
        <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between">
          <div class="flex flex-wrap gap-2">
            <button class="filter-btn active px-3 py-1 text-sm rounded-lg bg-indigo-600 text-white" data-filter="all">All</button>
            <button class="filter-btn px-3 py-1 text-sm rounded-lg bg-slate-800 text-slate-300 hover:bg-slate-700" data-filter="live">Live</button>
            <button class="filter-btn px-3 py-1 text-sm rounded-lg bg-slate-800 text-slate-300 hover:bg-slate-700" data-filter="filling">Filling</button>
            <button class="filter-btn px-3 py-1 text-sm rounded-lg bg-slate-800 text-slate-300 hover:bg-slate-700" data-filter="upcoming">Upcoming</button>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-sm text-slate-400">Sort by:</span>
            <select id="sort-tournaments" class="px-3 py-1 text-sm bg-slate-800 border border-slate-700 rounded-lg text-slate-300">
              <option value="prize">Prize Pool</option>
              <option value="players">Player Count</option>
              <option value="time">Start Time</option>
            </select>
          </div>
        </div>
      </section>

      <!-- Active Tournaments -->
      <section class="mb-8">
        <h2 class="text-xl font-bold mb-4">Active Tournaments</h2>
        <div id="tournaments-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          <!-- Tournament Card 1 -->
          <div class="tournament-card bg-slate-900 border border-slate-800 rounded-xl p-6 hover:border-slate-700 transition-colors" data-status="live" data-prize="5.2" data-players="24" data-time="2">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-semibold text-indigo-300">Crypto Clash Championship</h3>
              <div class="text-xs bg-green-600 text-white px-2 py-1 rounded">LIVE</div>
            </div>
            <div class="space-y-2 text-sm text-slate-400 mb-4">
              <div class="flex justify-between">
                <span>Prize Pool:</span>
                <span class="text-green-400 font-semibold">5.2 ETH</span>
              </div>
              <div class="flex justify-between">
                <span>Players:</span>
                <span class="text-slate-300">24/32</span>
              </div>
              <div class="flex justify-between">
                <span>Entry Fee:</span>
                <span class="text-slate-300">0.1 ETH</span>
              </div>
              <div class="flex justify-between">
                <span>Starts:</span>
                <span class="text-slate-300">In 2 hours</span>
              </div>
              <div class="flex justify-between">
                <span>Game:</span>
                <span class="text-slate-300">Battle Royale</span>
              </div>
            </div>
            <div class="flex gap-2">
              <button class="flex-1 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-lg font-semibold transition-colors join-tournament" data-tournament-id="1">
                Join Tournament
              </button>
              <button class="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors view-bracket" data-tournament-id="1">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                  <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- Tournament Card 2 -->
          <div class="tournament-card bg-slate-900 border border-slate-800 rounded-xl p-6 hover:border-slate-700 transition-colors" data-status="filling" data-prize="2.8" data-players="12" data-time="0">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-semibold text-indigo-300">NFT Warriors Battle</h3>
              <div class="text-xs bg-yellow-600 text-white px-2 py-1 rounded">FILLING</div>
            </div>
            <div class="space-y-2 text-sm text-slate-400 mb-4">
              <div class="flex justify-between">
                <span>Prize Pool:</span>
                <span class="text-green-400 font-semibold">2.8 ETH</span>
              </div>
              <div class="flex justify-between">
                <span>Players:</span>
                <span class="text-slate-300">12/16</span>
              </div>
              <div class="flex justify-between">
                <span>Entry Fee:</span>
                <span class="text-slate-300">0.2 ETH</span>
              </div>
              <div class="flex justify-between">
                <span>Starts:</span>
                <span class="text-slate-300">When full</span>
              </div>
              <div class="flex justify-between">
                <span>Game:</span>
                <span class="text-slate-300">Strategy</span>
              </div>
            </div>
            <div class="flex gap-2">
              <button class="flex-1 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-lg font-semibold transition-colors join-tournament" data-tournament-id="2">
                Join Tournament
              </button>
              <button class="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors view-bracket" data-tournament-id="2">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                  <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- Tournament Card 3 -->
          <div class="tournament-card bg-slate-900 border border-slate-800 rounded-xl p-6 hover:border-slate-700 transition-colors" data-status="upcoming" data-prize="10.0" data-players="0" data-time="24">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-semibold text-indigo-300">Weekly Legends Cup</h3>
              <div class="text-xs bg-blue-600 text-white px-2 py-1 rounded">UPCOMING</div>
            </div>
            <div class="space-y-2 text-sm text-slate-400 mb-4">
              <div class="flex justify-between">
                <span>Prize Pool:</span>
                <span class="text-green-400 font-semibold">10.0 ETH</span>
              </div>
              <div class="flex justify-between">
                <span>Players:</span>
                <span class="text-slate-300">0/64</span>
              </div>
              <div class="flex justify-between">
                <span>Entry Fee:</span>
                <span class="text-slate-300">0.15 ETH</span>
              </div>
              <div class="flex justify-between">
                <span>Starts:</span>
                <span class="text-slate-300">Tomorrow 6PM</span>
              </div>
              <div class="flex justify-between">
                <span>Game:</span>
                <span class="text-slate-300">MOBA</span>
              </div>
            </div>
            <div class="flex gap-2">
              <button class="flex-1 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-semibold transition-colors join-tournament" data-tournament-id="3">
                Register Early
              </button>
              <button class="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors view-bracket" data-tournament-id="3">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                  <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- Tournament Card 4 -->
          <div class="tournament-card bg-slate-900 border border-slate-800 rounded-xl p-6 hover:border-slate-700 transition-colors" data-status="filling" data-prize="1.6" data-players="6" data-time="0">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-semibold text-indigo-300">Speed Run Challenge</h3>
              <div class="text-xs bg-yellow-600 text-white px-2 py-1 rounded">FILLING</div>
            </div>
            <div class="space-y-2 text-sm text-slate-400 mb-4">
              <div class="flex justify-between">
                <span>Prize Pool:</span>
                <span class="text-green-400 font-semibold">1.6 ETH</span>
              </div>
              <div class="flex justify-between">
                <span>Players:</span>
                <span class="text-slate-300">6/8</span>
              </div>
              <div class="flex justify-between">
                <span>Entry Fee:</span>
                <span class="text-slate-300">0.2 ETH</span>
              </div>
              <div class="flex justify-between">
                <span>Starts:</span>
                <span class="text-slate-300">When full</span>
              </div>
              <div class="flex justify-between">
                <span>Game:</span>
                <span class="text-slate-300">Racing</span>
              </div>
            </div>
            <div class="flex gap-2">
              <button class="flex-1 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-lg font-semibold transition-colors join-tournament" data-tournament-id="4">
                Join Tournament
              </button>
              <button class="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors view-bracket" data-tournament-id="4">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                  <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Create Tournament -->
      <section class="grid lg:grid-cols-2 gap-6 mb-8">
        <div class="p-6 bg-slate-900 rounded-xl border border-slate-800/60 space-y-4">
          <h2 class="text-lg font-semibold text-indigo-200">Create New Tournament</h2>
          <p class="text-slate-400 text-sm">Launch your own tournament with automated Kwala workflows handling all the logistics.</p>

          <div class="space-y-4">
            <div class="space-y-2">
              <label class="block text-sm font-medium text-slate-300">Tournament Name</label>
              <input id="tournament-name" class="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 focus:border-indigo-500 focus:outline-none transition-colors" placeholder="Epic Gaming Championship" />
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div class="space-y-2">
                <label class="block text-sm font-medium text-slate-300">Max Players</label>
                <select id="max-players" class="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 focus:border-indigo-500 focus:outline-none transition-colors">
                  <option value="8">8 Players</option>
                  <option value="16">16 Players</option>
                  <option value="32">32 Players</option>
                  <option value="64">64 Players</option>
                </select>
              </div>
              <div class="space-y-2">
                <label class="block text-sm font-medium text-slate-300">Entry Fee (ETH)</label>
                <input id="entry-fee" type="number" step="0.01" min="0.01" class="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 focus:border-indigo-500 focus:outline-none transition-colors" placeholder="0.1" />
              </div>
            </div>

            <div class="space-y-2">
              <label class="block text-sm font-medium text-slate-300">Game Type</label>
              <select id="game-type" class="w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 focus:border-indigo-500 focus:outline-none transition-colors">
                <option value="Battle Royale">Battle Royale</option>
                <option value="Strategy">Strategy</option>
                <option value="MOBA">MOBA</option>
                <option value="Racing">Racing</option>
                <option value="Fighting">Fighting</option>
                <option value="Puzzle">Puzzle</option>
                <option value="Card Game">Card Game</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <button id="create-tournament" class="w-full py-3 rounded-lg bg-purple-600 hover:bg-purple-500 font-semibold transition-colors">
              üèÜ Create Tournament
            </button>
          </div>
        </div>

        <div class="p-6 bg-slate-900 rounded-xl border border-slate-800/60 space-y-4">
          <h2 class="text-lg font-semibold text-indigo-200">Connection Status</h2>
          <div class="grid grid-cols-1 gap-3 text-sm">
            <div class="flex justify-between items-center p-2 bg-slate-800/50 rounded">
              <span class="text-slate-400">Network:</span>
              <span id="network" class="text-slate-300 font-mono text-xs">-</span>
            </div>
            <div class="flex justify-between items-center p-2 bg-slate-800/50 rounded">
              <span class="text-slate-400">Account:</span>
              <span id="account" class="text-slate-300 font-mono text-xs">-</span>
            </div>
            <div class="flex justify-between items-center p-2 bg-slate-800/50 rounded">
              <span class="text-slate-400">Balance:</span>
              <span id="balance" class="text-slate-300 font-mono text-xs">-</span>
            </div>
          </div>
          
          <div class="space-y-2">
            <h3 class="text-sm font-medium text-slate-300">Activity Log</h3>
            <pre id="log" class="text-xs text-slate-300 whitespace-pre-wrap bg-slate-950/50 border border-slate-800 rounded-lg p-3 h-48 overflow-auto"></pre>
          </div>
        </div>
      </section>

      <!-- Recent Tournament Results -->
      <section class="mb-8">
        <h2 class="text-xl font-bold mb-4">Recent Tournament Results</h2>
        <div class="bg-slate-900/60 border border-slate-800 rounded-xl p-6">
          <div class="space-y-4">
            <div class="flex items-center justify-between p-4 bg-slate-800/50 rounded-lg">
              <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center">
                  <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                  </svg>
                </div>
                <div>
                  <div class="font-semibold text-slate-200">Crypto Clash Championship #47</div>
                  <div class="text-sm text-slate-400">Winner: CryptoGamer_Pro ‚Ä¢ 32 players ‚Ä¢ 2 hours ago</div>
                </div>
              </div>
              <div class="text-right">
                <div class="text-green-400 font-semibold">5.2 ETH</div>
                <div class="text-xs text-slate-400">Prize Pool</div>
              </div>
            </div>

            <div class="flex items-center justify-between p-4 bg-slate-800/50 rounded-lg">
              <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center">
                  <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                  </svg>
                </div>
                <div>
                  <div class="font-semibold text-slate-200">NFT Warriors Battle #46</div>
                  <div class="text-sm text-slate-400">Winner: BlockchainBeast ‚Ä¢ 16 players ‚Ä¢ 4 hours ago</div>
                </div>
              </div>
              <div class="text-right">
                <div class="text-green-400 font-semibold">2.8 ETH</div>
                <div class="text-xs text-slate-400">Prize Pool</div>
              </div>
            </div>

            <div class="flex items-center justify-between p-4 bg-slate-800/50 rounded-lg">
              <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center">
                  <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                  </svg>
                </div>
                <div>
                  <div class="font-semibold text-slate-200">Speed Run Challenge #45</div>
                  <div class="text-sm text-slate-400">Winner: FastFingers ‚Ä¢ 8 players ‚Ä¢ 6 hours ago</div>
                </div>
              </div>
              <div class="text-right">
                <div class="text-green-400 font-semibold">1.6 ETH</div>
                <div class="text-xs text-slate-400">Prize Pool</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- How Kwala Powers Tournaments -->
      <section class="bg-slate-900/40 border border-slate-800 rounded-xl p-6">
        <h2 class="text-xl font-bold mb-4">How Kwala Powers Tournament Automation</h2>
        <div class="grid md:grid-cols-4 gap-6">
          <div class="space-y-2">
            <div class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center text-sm font-bold">1</div>
            <h3 class="font-semibold text-indigo-300">Registration</h3>
            <p class="text-sm text-slate-400">Players register and pay entry fees through smart contracts. Kwala monitors registration events.</p>
          </div>
          <div class="space-y-2">
            <div class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center text-sm font-bold">2</div>
            <h3 class="font-semibold text-indigo-300">Bracket Generation</h3>
            <p class="text-sm text-slate-400">When full, Kwala workflows automatically generate tournament brackets and schedule matches.</p>
          </div>
          <div class="space-y-2">
            <div class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center text-sm font-bold">3</div>
            <h3 class="font-semibold text-indigo-300">Match Updates</h3>
            <p class="text-sm text-slate-400">Game results trigger Kwala workflows to update brackets and advance winners automatically.</p>
          </div>
          <div class="space-y-2">
            <div class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center text-sm font-bold">4</div>
            <h3 class="font-semibold text-indigo-300">Prize Distribution</h3>
            <p class="text-sm text-slate-400">Tournament completion triggers automatic prize distribution to winners based on final standings.</p>
          </div>
        </div>
      </section>
    </main>

    <script>
      // Kwala Testnet Configuration
      const KWALA_TESTNET_DEC = 2410;
      const KWALA_TESTNET_HEX = '0x96A';
      const KWALA_TESTNET = {
        chainId: KWALA_TESTNET_HEX,
        chainName: 'Kwala Testnet',
        nativeCurrency: { name: 'KWALA', symbol: 'KWALA', decimals: 18 },
        rpcUrls: ['https://testnet-rpc.kwala.com'],
        blockExplorerUrls: ['https://testnet-explorer.kwala.com']
      };

      const tournamentAbi = [
        "event TournamentCreated(uint256 indexed tournamentId, address indexed creator, string name, uint256 maxPlayers, uint256 entryFee)",
        "event PlayerRegistered(uint256 indexed tournamentId, address indexed player)",
        "event TournamentStarted(uint256 indexed tournamentId)",
        "event MatchCompleted(uint256 indexed tournamentId, address indexed winner, address indexed loser)",
        "event TournamentCompleted(uint256 indexed tournamentId, address indexed winner, uint256 prizeAmount)",
        "function createTournament(string memory name, uint256 maxPlayers, uint256 entryFee) external returns (uint256)",
        "function registerForTournament(uint256 tournamentId) external payable",
        "function reportMatchResult(uint256 tournamentId, address winner, address loser) external"
      ];

      function log(msg){
        const el = document.getElementById('log');
        const time = new Date().toLocaleTimeString();
        el.textContent += `\n[${time}] ${msg}`;
        el.scrollTop = el.scrollHeight;
      }

      async function ensureWallet() {
        if (!window.ethereum) throw new Error('No wallet found (install MetaMask/Coinbase Wallet)');
        const provider = new ethers.providers.Web3Provider(window.ethereum, 'any');
        const network = await provider.getNetwork();
        document.getElementById('network').textContent = `${network.name} (id ${network.chainId})`;
        return provider;
      }

      async function switchToKwalaTestnet(provider) {
        try {
          await provider.send('wallet_switchEthereumChain', [{ chainId: KWALA_TESTNET_HEX }]);
        } catch (err) {
          if (err && err.code === 4902) {
            await provider.send('wallet_addEthereumChain', [KWALA_TESTNET]);
          } else {
            throw err;
          }
        }
      }

      async function connect() {
        const provider = await ensureWallet();
        const net = await provider.getNetwork();
        if (net.chainId !== KWALA_TESTNET_DEC) {
          log('Switching network to Kwala Testnet...');
          await switchToKwalaTestnet(provider);
        }
        const accounts = await provider.send('eth_requestAccounts', []);
        const account = accounts[0];
        document.getElementById('account').textContent = account || '-';
        
        // Get balance
        const balance = await provider.getBalance(account);
        document.getElementById('balance').textContent = `${ethers.utils.formatEther(balance)} KWALA`;
        
        const refreshed = await provider.getNetwork();
        document.getElementById('network').textContent = `${refreshed.name} (id ${refreshed.chainId})`;
        log('Wallet connected to Kwala Testnet');
        return provider;
      }

      document.getElementById('connect').addEventListener('click', async (e) => {
        const btn = e.currentTarget; 
        btn.disabled = true; 
        btn.textContent = 'Connecting...';
        try { 
          await connect(); 
        } catch (e) { 
          log(`Error: ${e.message || e}`); 
        }
        finally { 
          btn.disabled = false; 
          btn.textContent = 'Connect Wallet'; 
        }
      });

      document.getElementById('create-tournament').addEventListener('click', async (e) => {
        const btn = e.target;
        const originalText = btn.textContent;
        
        try {
          const provider = await connect();
          const signer = provider.getSigner();
          
          const name = document.getElementById('tournament-name').value.trim();
          const maxPlayers = parseInt(document.getElementById('max-players').value);
          const entryFee = document.getElementById('entry-fee').value || '0';
          const gameType = document.getElementById('game-type').value;
          
          // Validation
          if (!name) throw new Error('Tournament name is required');
          if (name.length < 3) throw new Error('Tournament name must be at least 3 characters');
          if (parseFloat(entryFee) <= 0) throw new Error('Entry fee must be greater than 0');
          
          btn.textContent = 'Creating Tournament...';
          btn.disabled = true;
          
          log(`Creating tournament: ${name}`);
          log(`Players: ${maxPlayers}, Entry Fee: ${entryFee} KWALA, Game: ${gameType}`);
          
          // Simulate transaction delay
          await new Promise(resolve => setTimeout(resolve, 3000));
          
          const mockTxHash = '0x' + Math.random().toString(16).substr(2, 64);
          const tournamentId = Math.floor(Math.random() * 1000) + 100;
          
          log(`Tournament created successfully!`);
          log(`Tournament ID: ${tournamentId}`);
          log(`Transaction: ${mockTxHash}`);
          log('Kwala workflow is now monitoring for player registrations');
          
          // Add new tournament to the grid
          addNewTournamentToGrid({
            id: tournamentId,
            name: name,
            maxPlayers: maxPlayers,
            entryFee: entryFee,
            gameType: gameType,
            status: 'filling'
          });
          
          // Clear form
          document.getElementById('tournament-name').value = '';
          document.getElementById('entry-fee').value = '';
          
          // Show success message
          showNotification(`Tournament "${name}" created successfully!`, 'success');
          
          // Update stats
          updateTournamentStats();
          
        } catch (e) {
          log(`Error: ${e.message || e}`);
          showNotification(`Error: ${e.message}`, 'error');
        } finally {
          btn.textContent = originalText;
          btn.disabled = false;
        }
      });

      // Add new tournament to grid
      function addNewTournamentToGrid(tournament) {
        const tournamentsGrid = document.getElementById('tournaments-grid');
        
        const newCard = document.createElement('div');
        newCard.className = 'tournament-card bg-slate-900 border border-slate-800 rounded-xl p-6 hover:border-slate-700 transition-colors animate-pulse';
        newCard.dataset.status = tournament.status;
        newCard.dataset.prize = tournament.entryFee;
        newCard.dataset.players = '0';
        newCard.dataset.time = '0';
        
        newCard.innerHTML = `
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-semibold text-indigo-300">${tournament.name}</h3>
            <div class="text-xs bg-yellow-600 text-white px-2 py-1 rounded">FILLING</div>
          </div>
          <div class="space-y-2 text-sm text-slate-400 mb-4">
            <div class="flex justify-between">
              <span>Prize Pool:</span>
              <span class="text-green-400 font-semibold">${tournament.entryFee} ETH</span>
            </div>
            <div class="flex justify-between">
              <span>Players:</span>
              <span class="text-slate-300">0/${tournament.maxPlayers}</span>
            </div>
            <div class="flex justify-between">
              <span>Entry Fee:</span>
              <span class="text-slate-300">${(parseFloat(tournament.entryFee) / tournament.maxPlayers).toFixed(3)} ETH</span>
            </div>
            <div class="flex justify-between">
              <span>Starts:</span>
              <span class="text-slate-300">When full</span>
            </div>
            <div class="flex justify-between">
              <span>Game:</span>
              <span class="text-slate-300">${tournament.gameType}</span>
            </div>
          </div>
          <div class="flex gap-2">
            <button class="flex-1 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-lg font-semibold transition-colors join-tournament" data-tournament-id="${tournament.id}">
              Join Tournament
            </button>
            <button class="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors view-bracket" data-tournament-id="${tournament.id}">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
              </svg>
            </button>
          </div>
        `;
        
        // Add event listeners to new buttons
        const joinBtn = newCard.querySelector('.join-tournament');
        const viewBtn = newCard.querySelector('.view-bracket');
        
        joinBtn.addEventListener('click', handleJoinTournament);
        viewBtn.addEventListener('click', handleViewBracket);
        
        // Add to beginning of grid
        tournamentsGrid.insertBefore(newCard, tournamentsGrid.firstChild);
        
        // Remove animation after 3 seconds
        setTimeout(() => {
          newCard.classList.remove('animate-pulse');
        }, 3000);
      }

      // Update tournament stats
      function updateTournamentStats() {
        const currentCount = parseInt(document.getElementById('active-tournaments-count').textContent);
        document.getElementById('active-tournaments-count').textContent = currentCount + 1;
        
        const currentPrize = parseFloat(document.getElementById('total-prize-pool').textContent);
        const newPrize = (currentPrize + Math.random() * 2 + 0.5).toFixed(1);
        document.getElementById('total-prize-pool').textContent = newPrize + ' ETH';
        
        const currentToday = parseInt(document.getElementById('tournaments-today').textContent);
        document.getElementById('tournaments-today').textContent = currentToday + 1;
      }

      // Handle join tournament (for dynamically added buttons)
      function handleJoinTournament(e) {
        const tournamentId = e.target.dataset.tournamentId;
        const originalText = e.target.textContent;
        
        connect().then(() => {
          e.target.textContent = 'Joining...';
          e.target.disabled = true;
          
          log(`Joining tournament #${tournamentId}...`);
          
          setTimeout(() => {
            const mockTxHash = '0x' + Math.random().toString(16).substr(2, 64);
            log(`Registration successful! Tx: ${mockTxHash}`);
            
            e.target.textContent = 'Registered ‚úì';
            e.target.classList.remove('bg-indigo-600', 'hover:bg-indigo-500');
            e.target.classList.add('bg-green-600');
            
            showNotification('Successfully joined tournament!', 'success');
          }, 2000);
        }).catch(error => {
          log(`Error: ${error.message || error}`);
          e.target.textContent = originalText;
          e.target.disabled = false;
          showNotification('Failed to join tournament', 'error');
        });
      }

      // Handle view bracket (for dynamically added buttons)
      function handleViewBracket(e) {
        const tournamentId = e.target.closest('button').dataset.tournamentId;
        showBracket(tournamentId);
      }

      // Mobile menu toggle
      document.getElementById('mobile-menu').addEventListener('click', () => {
        const nav = document.getElementById('mobile-nav');
        nav.classList.toggle('hidden');
      });

      // Mobile connect button
      document.getElementById('connect-mobile').addEventListener('click', async (e) => {
        const btn = e.currentTarget; 
        btn.disabled = true; 
        btn.textContent = 'Connecting...';
        try { 
          await connect(); 
        } catch (e) { 
          log(`Error: ${e.message || e}`); 
        }
        finally { 
          btn.disabled = false; 
          btn.textContent = 'Connect Wallet'; 
        }
      });

      // Tournament filtering and sorting
      const filterButtons = document.querySelectorAll('.filter-btn');
      const sortSelect = document.getElementById('sort-tournaments');
      const tournamentsGrid = document.getElementById('tournaments-grid');
      
      filterButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          // Update active filter button
          filterButtons.forEach(b => {
            b.classList.remove('active', 'bg-indigo-600', 'text-white');
            b.classList.add('bg-slate-800', 'text-slate-300');
          });
          btn.classList.add('active', 'bg-indigo-600', 'text-white');
          btn.classList.remove('bg-slate-800', 'text-slate-300');
          
          // Filter tournaments
          const filter = btn.dataset.filter;
          const cards = document.querySelectorAll('.tournament-card');
          
          cards.forEach(card => {
            if (filter === 'all' || card.dataset.status === filter) {
              card.style.display = 'block';
            } else {
              card.style.display = 'none';
            }
          });
        });
      });
      
      sortSelect.addEventListener('change', () => {
        const sortBy = sortSelect.value;
        const cards = Array.from(document.querySelectorAll('.tournament-card'));
        
        cards.sort((a, b) => {
          let aVal, bVal;
          
          switch(sortBy) {
            case 'prize':
              aVal = parseFloat(a.dataset.prize);
              bVal = parseFloat(b.dataset.prize);
              return bVal - aVal; // Descending
            case 'players':
              aVal = parseInt(a.dataset.players);
              bVal = parseInt(b.dataset.players);
              return bVal - aVal; // Descending
            case 'time':
              aVal = parseInt(a.dataset.time);
              bVal = parseInt(b.dataset.time);
              return aVal - bVal; // Ascending
            default:
              return 0;
          }
        });
        
        // Re-append sorted cards
        cards.forEach(card => tournamentsGrid.appendChild(card));
      });

      // Tournament join functionality
      document.querySelectorAll('.join-tournament').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          const tournamentId = e.target.dataset.tournamentId;
          const originalText = e.target.textContent;
          
          try {
            await connect();
            e.target.textContent = 'Joining...';
            e.target.disabled = true;
            
            log(`Joining tournament #${tournamentId}...`);
            
            // Simulate registration transaction
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            const mockTxHash = '0x' + Math.random().toString(16).substr(2, 64);
            log(`Registration successful! Tx: ${mockTxHash}`);
            log('Kwala workflow will handle bracket updates automatically');
            
            // Update UI
            e.target.textContent = 'Registered ‚úì';
            e.target.classList.remove('bg-indigo-600', 'hover:bg-indigo-500');
            e.target.classList.add('bg-green-600');
            
            // Show success notification
            showNotification('Successfully joined tournament!', 'success');
            
          } catch (error) {
            log(`Error: ${error.message || error}`);
            e.target.textContent = originalText;
            e.target.disabled = false;
            showNotification('Failed to join tournament', 'error');
          }
        });
      });

      // View bracket functionality
      document.querySelectorAll('.view-bracket').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const tournamentId = e.target.closest('button').dataset.tournamentId;
          showBracket(tournamentId);
        });
      });

      // Notification system
      function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 px-4 py-2 rounded-lg text-white z-50 ${
          type === 'success' ? 'bg-green-600' : 
          type === 'error' ? 'bg-red-600' : 'bg-blue-600'
        }`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.remove();
        }, 3000);
      }

      // Show bracket modal
      function showBracket(tournamentId) {
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4';
        modal.innerHTML = `
          <div class="bg-slate-900 rounded-xl p-6 max-w-4xl w-full max-h-[80vh] overflow-auto">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-xl font-bold text-indigo-300">Tournament #${tournamentId} Bracket</h3>
              <button class="close-modal text-slate-400 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
            <div class="bracket-container">
              ${generateBracketHTML(tournamentId)}
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        
        modal.querySelector('.close-modal').addEventListener('click', () => {
          modal.remove();
        });
        
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.remove();
          }
        });
      }

      // Generate bracket HTML
      function generateBracketHTML(tournamentId) {
        const brackets = {
          '1': {
            rounds: [
              { name: 'Round 1', matches: [
                { player1: 'CryptoGamer_Pro', player2: 'BlockchainBeast', winner: 'CryptoGamer_Pro' },
                { player1: 'MetaWarrior', player2: 'ChainChampion', winner: 'MetaWarrior' },
                { player1: 'DigitalDragon', player2: 'FastFingers', winner: 'DigitalDragon' },
                { player1: 'Web3Wizard', player2: 'DeFiDominator', winner: 'Web3Wizard' }
              ]},
              { name: 'Semi-Finals', matches: [
                { player1: 'CryptoGamer_Pro', player2: 'MetaWarrior', winner: 'CryptoGamer_Pro' },
                { player1: 'DigitalDragon', player2: 'Web3Wizard', winner: 'DigitalDragon' }
              ]},
              { name: 'Finals', matches: [
                { player1: 'CryptoGamer_Pro', player2: 'DigitalDragon', winner: 'CryptoGamer_Pro' }
              ]}
            ]
          },
          '2': {
            rounds: [
              { name: 'Round 1', matches: [
                { player1: 'NFTNinja', player2: 'TokenTitan', winner: null },
                { player1: 'CryptoKnight', player2: 'BlockBuster', winner: null }
              ]}
            ]
          }
        };
        
        const bracket = brackets[tournamentId] || { rounds: [{ name: 'Waiting for players...', matches: [] }] };
        
        return bracket.rounds.map(round => `
          <div class="mb-6">
            <h4 class="text-lg font-semibold text-slate-200 mb-3">${round.name}</h4>
            <div class="space-y-2">
              ${round.matches.map(match => `
                <div class="flex items-center justify-between p-3 bg-slate-800 rounded-lg">
                  <div class="flex-1">
                    <div class="text-sm ${match.winner === match.player1 ? 'text-green-400 font-semibold' : 'text-slate-300'}">${match.player1}</div>
                    <div class="text-xs text-slate-500">vs</div>
                    <div class="text-sm ${match.winner === match.player2 ? 'text-green-400 font-semibold' : 'text-slate-300'}">${match.player2}</div>
                  </div>
                  <div class="text-xs ${match.winner ? 'text-green-400' : 'text-yellow-400'}">
                    ${match.winner ? `Winner: ${match.winner}` : 'In Progress'}
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `).join('');
      }
    </script>
  </body>
</html>